<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html>
<head>
<style>
table, th, td {
    border: 1px solid black;
    padding: 5px;
}
table {
    border-spacing: 5px;
}
</style>

<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>clusters information</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

<script type="text/javascript"  src="http://code.jquery.com/jquery-1.10.0.min.js"></script>
<script type="text/javascript"  src="jquery.tablesorter.min.js"></script>
<script src="read.js"></script>
<script src='js/sql.js'></script>


<script>


jQuery(document).ready(function() 
{
    
    var fileInput = document.getElementById('files');

    // Load a db from a file
    fileInput.addEventListener('change', function(e) {
        var file = fileInput.files[0];
        var fileDisplayArea = document.getElementById('table');
		fileDisplayArea.innerText = ""
        var tableDisplayArea = document.getElementById("myTable");
		var reader = new FileReader();              
        reader.onload = function(e) {
           var Uints = new Uint8Array(reader.result);
           var db = new SQL.Database(Uints);
//           var contents = db.exec("SELECT Id, Locus FROM clusters WHERE Id=1");
//           var contents = db.exec("SELECT * FROM clusters WHERE Id=1");
//		   var str = "SELECT * FROM clusters WHERE Id=" + 3;	
//           var contents = db.exec(str);
//           var contents = db.exec("SELECT Id, Annotation FROM clusters");
           var contents = db.exec("SELECT Id FROM clusters");
           console.log(contents);
			

           // Create an empty <thead> element and add it to the table:
           //var header = tableDisplayArea.createTHead();

           var i = 1;
		   contents[0]['values'].sort().forEach(function(entry) {
			   var str = "SELECT Description FROM clusters WHERE Id=" + entry;	
    	       var cts = db.exec(str);
			   console.log(entry);
               //fileDisplayArea.innerText = fileDisplayArea.innerText + entry + " > " + cts[0]['values'] + "\n";
			   
               //fileDisplayArea.innerText = fileDisplayArea.innerText + i + "\n";
			   
			   
			   
               // Create an empty <tr> element and add it to the first position of <thead>:
               var row = tableDisplayArea.insertRow(i);
               i++;

               // Insert a new cell (<td>) at the first position of the "new" <tr> element:
               var cell0 = row.insertCell(0);
               var cell1 = row.insertCell(1);
               var cell2 = row.insertCell(2);

               // Add some bold text in the new cell:
               //cell.innerHTML = "<b>This is a table header</b>";			   
			   
			   
               var checkbox = document.createElement('input');
               checkbox.type = "checkbox";
               checkbox.name = entry;
               checkbox.value = entry;
               checkbox.id = entry;

               var lab = document.createElement('label');
               lab.htmlFor = entry;
               lab.appendChild(document.createTextNode(entry));

               var label = document.createElement('label');
               label.htmlFor = entry;
               label.appendChild(document.createTextNode(cts[0]['values']));

               cell0.appendChild(checkbox);
               cell1.appendChild(lab);
               cell2.appendChild(label);
			   
			   
			   
			   
			   
			   
			   
  		   });
//           fileDisplayArea.innerText = contents[0]['values'];
    
			
			
			
			
			
			
        }
        reader.readAsArrayBuffer(file);
       // Prepare a statement
            
        });
   
});

	
	
	
	
	
	
	
function filter (term, _id, cellNr){
	var suche = term.value.toLowerCase();
	var table = document.getElementById(_id);
	var ele;
	for (var r = 1; r < table.rows.length; r++){
		ele = table.rows[r].cells[cellNr].innerHTML.replace(/<[^>]+>/g,"");
		if (ele.toLowerCase().indexOf(suche)>=0 )
			table.rows[r].style.display = '';
		else table.rows[r].style.display = 'none';
	}
}	
	

	
	
	
	
	
	
function myFuncShowLocus() {
    var tblDisplay = document.getElementById("myTableLocus");
    var fileInput = document.getElementById('files');
	
	var file = fileInput.files[0];
    console.log(file);
	var reader1 = new FileReader();              
    reader1.onload = function(e) {
       var Uints = new Uint8Array(reader1.result);
       var db = new SQL.Database(Uints);

       var contents = db.exec("SELECT Id FROM clusters");
       console.log(contents);
		
	   var c = -1;
       contents[0]['values'].sort().forEach(function(entry) {
		  if (document.getElementById(entry).checked) {
            c = entry;
			document.getElementById(entry).checked = false;
          }
	   });
		
	   if (c > -1) {
	      document.getElementById(c).checked = true;
		   
	      var str = "SELECT Locus FROM clusters WHERE Id=" + c;	
          var cts = db.exec(str);
	      console.log(cts);
	    
	      // esto para transformat el valor a variables
	      locus_array = JSON.parse(cts[0]['values']);
          console.log(locus_array);
		   
		   
		  //Deleting rows from table
		  var rowCount = tblDisplay.rows.length;
		  for (var x=rowCount-1; x>0; x--) {
		     tblDisplay.deleteRow(x);
		  }
		   
		  //Inserting new rows
          var i = 1;
          locus_array.forEach(function(entry) {
               var row = tblDisplay.insertRow(i);
               i++;

               // Insert a new cell (<td>) at the first position of the "new" <tr> element:
               var cell0 = row.insertCell(0);
               var cell1 = row.insertCell(1);
               var cell2 = row.insertCell(2);

			  
               var lab0 = document.createElement('label');
               lab0.htmlFor = i;
               lab0.appendChild(document.createTextNode(c));

               var lab1 = document.createElement('label');
               lab1.htmlFor = i;
               lab1.appendChild(document.createTextNode(i-2));

			  
			   var entr  = String(entry);
			   var entr0 = entr.split(",");
			   var entr1 = entr0[1] + ":" + entr0[2] + "-" + entr0[3];
               var lab2 = document.createElement('label');
               lab2.htmlFor = i;
               lab2.appendChild(document.createTextNode(entr1));

               cell0.appendChild(lab0);
               cell1.appendChild(lab1);
               cell2.appendChild(lab2);
		   
		   
		  }); 
		   
		   
		   
		   
		   
		   
	   }
		
		
		
		
		
		
		
		
		
		
		
		
		
    }
    reader1.readAsArrayBuffer(file);
    	



}	
	
	
	
	
	
</script>

</head>
<body id="main">


<input type="file" id="files" name="files[]" />

<input name="filter" onkeyup="filter(this, 'myTable', 2)" type="text">	
	
<h4>Table with clusters</h4>
<br>
<div id="table"></div>
<table style="width:80%" align="center" id="myTable">
  <tr>
    <td></td>
    <td>I.D.</td>		
    <td>Description:</td>
  </tr>
</table>
	
	
<h4>Table with Locus</h4>
<br>
<button onclick="myFuncShowLocus()">Show Locus</button>
<br>
<table style="width:80%" align="center" id="myTableLocus">
  <tr>
    <td>I.D.</td>		
    <td>Index</td>		
    <td>Locus:</td>
  </tr>
	
	
	
	
</table>
	
	
	
	
	
	
	
	
	
	
</html>
